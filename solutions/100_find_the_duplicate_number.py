# 力扣 热题100 · 第100题 寻找重复数
# 链接: https://leetcode.cn/problems/find-the-duplicate-number/
#
# ---------- 思路 ----------
# 题目在问什么：长度为 n+1 的数组，值域 1~n，有且仅有一个数重复，找这个数。要求不改数组、O(1) 空间。
#
# 做法：把「下标 i → 值 nums[i]」当成一条边，每个位置一条出边，必有环且环入口即重复数（因为有两个下标指向同一个值）。用快慢指针先相遇，再把一个放回 0，同速走，相遇点就是环入口（同 26 题环形链表 II）。
#
# ---------- 关键点 ----------
# · 为什么能看成「链表」：把每个下标 i 连一条边到 nums[i]，因为值域是 1~n，除了 0 以外每个值都至少被指一次；有且仅有一个数重复，说明有恰好两个不同下标 p、q 满足 nums[p]=nums[q]=v，即两个位置都指向 v，从 0 出发沿边走，一定会先进入这条链，然后走到 v，再从 v 继续走会再次回到 v，形成环，且 v 就是环的入口（第一次被「两步」到达的点）。
# · 0 一定不在环上：所有边的终点都是 1~n，没有任何边指向 0，所以从 0 出发是一段「链」再进入环，不会从环回到 0。
# · 环入口为什么就是重复的数：入口是「有两个不同前驱指向它」的点——一个是链上走进环的那个点，另一个是环内指向它的点。在数组里「有两个前驱」等价于「有两个下标的值都是它」，即重复的那个数。
# · 为什么不能像「缺失第一个正数」那样原地交换：那道题可以交换是因为允许改数组，且利用「数值 1~n 对应下标 0~n-1」做桶。本题要求不改数组、O(1) 空间，所以不能改值，只能把数组当成只读的「图」用快慢指针判圈找入口。

from typing import List


class Solution:
    def findDuplicate(self, nums: List[int]) -> int:
        slow = fast = 0
        while True:
            slow = nums[slow]
            fast = nums[nums[fast]]
            if slow == fast:
                break
        slow = 0
        while slow != fast:
            slow = nums[slow]
            fast = nums[fast]
        return slow
